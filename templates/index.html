<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Map Watcher</title>
    <link rel="stylesheet" href="/css/master.css">
  </head>
  <body>
    <div class="container">
      <div class="overworld">
        <img src="/images/overworld.jpg" alt="">
        <!-- <div class="dot" id='1'></div> -->
      </div>
    </div>
    <input type="text" id="tmp" name="" value="">
  </body>
  <script type="text/javascript" src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
  <script src="/js/constants.js" charset="utf-8"></script>
  <script type="text/javascript" charset="utf-8">
      $.ajax({
        url: '/getsession',
        type: 'GET'
      })
      .done(function(data) {
        console.log(data);
        jQuery.each(data, function (i, val) {
          console.log(i);
        $('.overworld').append('<div id="'+i+'" class="dot" style="background-color: '+this['colour']+'; top: '+LOCATIONS[this['location']][0]+'px; left: '+LOCATIONS[this['location']][1]+'px"><div>')
        })
      })
      .fail(function() {
        console.log("error");
      })
      .always(function() {
        console.log("complete");
      });


      var socket = io.connect('http://' + document.domain + ':' + location.port);
      socket.on('connect', function() {
          socket.emit('my event', {data: 'I\'m connected!'});
      });

      socket.on('updatemap', function (data) {
        // console.log(data);
        // $('h2').html(data['player']);
        // console.log('#'+data['id']);
        console.log($('#' + data['id']));
        console.log(data)
        $('#' + data['id']).animate({
          'top': LOCATIONS[data['locationNum']][0]+'px',
          'left': LOCATIONS[data['locationNum']][1]+'px'
        }, 1500);
        // $('.dot').css('top', LOCATIONS[data['id']][0]+'px');
        // $('.dot').css('left', LOCATIONS[data['id']][1]+'px');
      })

      socket.on('createdot', function (data) {
        $('.overworld').append('<div id="'+data['id']+'" class="dot" style="background-color: '+data['colour']+'; top: '+LOCATIONS[data['locationNum']][0]+'px; left: '+LOCATIONS[data['locationNum']][1]+'px"><div>')
        console.log(data)
        // $('#'+data['id']).css('background-color', data['colour']);
      })

      $('img').on('click', function(event) {
        event.preventDefault();
        // console.log(event.originalEvent.layerX);
        // console.log(event.originalEvent.layerY);
        $('#tmp').val("[" + (event.originalEvent.layerY-13) + "," + (event.originalEvent.layerX-13) + "]");
        $('#tmp').select();
        document.execCommand("copy");
        console.clear();
        $('.dot').css('top', event.originalEvent.layerY-13+'px');
        $('.dot').css('left', event.originalEvent.layerX-13+'px');
        console.log("[" + (event.originalEvent.layerY-13) + "," + (event.originalEvent.layerX-13) + "]");
      });
  </script>
</html>
